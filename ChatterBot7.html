<!DOCTYPE html>
<html>
    <head>
        <title>ChatterBot 7</title>
        <style>
            #working{
                position: fixed;
                width:100%;
                left: 10;
                bottom: 0;
                text-align: center;
                background-color: white;
            }
            #text{
                margin: 50px;
            }
            #top{
                text-align: center;
            }

            /* The Modal (background) */
            .modal {
                display: none; /* Hidden by default */
                position: fixed; /* Stay in place */
                z-index: 1; /* Sit on top */
                padding-top: 100px; /* Location of the box */
                left: 0;
                top: 0;
                width: 100%; /* Full width */
                height: 100%; /* Full height */
                overflow: auto; /* Enable scroll if needed */
                background-color: rgb(0,0,0); /* Fallback color */
                background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            }
            /* Modal Content */
            .modal-content {
                background-color: #fefefe;
                margin: auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
            }
            /* The Close Button */
            .close {
                color: #aaaaaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            .close:hover,
                .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }
        </style>
    </head>
    <body>
        <div id="top">
            <hr>
            <h1>ChatterBot 7.0</h1>
            <button onclick="document.getElementById('add').style.display = 'block';">Add Training Data</button>
            <button onclick="document.getElementById('about').style.display = 'block';">About</button>
            <button onclick="document.getElementById('settings').style.display = 'block';">Settings</button>
            <button onclick="document.getElementById('terms').style.display = 'block';">Terms Of Use</button>
            <button onclick="document.getElementById('text').innerHTML = '';">Clear Chat</button>
            <hr>
        </div>
        <p id="text"></p><br><br><br><br>
        <div id="working">
            <hr>
            <input id="input" placeholder="Ask ChatterBot Anything">
            <button onclick="Run()">Ask</button>
            <hr>
        </div>
        <!-- The Modal -->
        <div id="about" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('about').style.display = 'none';">&times;</span>
                <h1>About ChatterBot</h1>
                <h3>General</h3>
                <p>Created in November 17, 2025, ChatterBot 7.0 is a new model in a series of text-generation programs. The text generated by the model is trained off of <a href="https://en.wikipedia.org/api/rest_v1/" target="_blank">Wikimedia REST API</a>, user inputs, and user inputed training data.
                <br>Data used is per-device and can be reset, we will not and can not sell your data. ChatterBot generates text based off of your prompts, therefore, we are not liable for any text generated by the model.</p>
                <h3>Technical Overview</h3>
                <p>While older versions have used N-GRAMS for text generation, ChatterBot 7.0 utilizes anti-hebbian association and BFS(Breadth-First Search) to construct lines of text relating to your answer.
                    <br>Although complex, this program is not technically Ai and is even less reliable. Any correct information is coincedence.
                </p>
            </div>
        </div>
        <div id="settings" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('settings').style.display = 'none';">&times;</span>
                <h1>Settings</h1>
                <input type="checkbox" id="isRight" value="false" checked><label for="isRight">Display User Prompts On Right</label><br>
                <input type="checkbox" id="useWiki" checked=><label for="useWiki">Use <a href="https://en.wikipedia.org/api/rest_v1/" target="_blank">Wikimedia REST API</a> Automatically as training data</label><br>
                <input type="checkbox" id="showWiki" checked><label for="showWiki">Display Uses Of <a href="https://en.wikipedia.org/api/rest_v1/" target="_blank">Wikimedia REST API</a></label><br>
                <input type="checkbox" id="usePrompt" checked><label for="usePrompt">Use User Prompts As Training Data</label><br>
                <input type="checkbox" id="showMap"><label for="showMap">Display Sentence Mapping</label><br>
                Words Attempted Per Word In Prompt:<br>
                Min: <input type="number" min="1" max="10" value="1" id="min">Max: <input type="number" min="1" max="10" value="3" id="max">
            </div>
        </div>
        <div id="terms" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('terms').style.display = 'none';">&times;</span>
                <h1>Terms And Conditions</h1>
                <p>By using Chatter Bot You Agree To The Following Terms And Conditions:<br><br>
                    ChatterBot and its creators are not liable or responsable for any content generated by ChatterBot. Currently, ChatterBot does not have any restrictions, and will be able to say anything that it learns from the data it collects.
                    By using this program, you accept and agree that content generated is not the fault of the creators or the program, rather the fault of the data that the program has access to. Unintentionally created harmful content,
                    as well as bugs or glitches should be reported to bgronfur@gmail.com<br><br>
                    By using this program you agree to not intentionally create any harmful or inappropriate responses<br><br>
                    All responses by ChatterBot are generated by probibility, and therefore should not be trusted for any reason. Any correct information is coincedence.<br><br>
                    ChatterBot currently uses <a href="https://en.wikipedia.org/api/rest_v1/" target="_blank">Wikimedia REST API</a> to generate better responses and by using you also 
                    agree to Wikimedia's <a href="https://foundation.wikimedia.org/wiki/Policy:Terms_of_Use" target="_blank">Terms Of Use</a> and <a href="https://foundation.wikimedia.org/wiki/Policy:Privacy_policy" target="_blank">Privacy Policy</a><br>
                    <a href="https://en.wikipedia.org/api/rest_v1/" target="_blank">Wikimedia REST API</a> will not be used if disabled in settings or without internet connection, however by using this program you still agree to its Terms, to prevent complications. 
                    This instance of ChatterBot is a local file and does not store data or preferences. We will not and can not save, save, or sell any information entered into ChatterBot, however use of the <a href="https://en.wikipedia.org/api/rest_v1/" target="_blank">Wikimedia REST API</a>
                    may be able to be tracked or recorded by Wikimedia according to their <a href="https://foundation.wikimedia.org/wiki/Policy:Privacy_policy" target="_blank">Privacy Policy</a>.
                </p>
                <p></p>
            </div>
        </div>
        <div id="add" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('add').style.display = 'none';">&times;</span>
                <h1>Add Training Data</h1>
                <p id="wordCount">0 Known Words</p><br>
                <textarea id="train"></textarea><br>
                <button onclick="gettingArticle=true;process(document.getElementById('train').value);document.getElementById('train').value='';">Input</button><br><br>
                <input type="file" name="inputfile" id="inputfile" multiple="true" title="Import Files, All Files Are Read As Text"><br>
                <button onclick="process(prompt('Enter Training Data'));" title="Copy And Paste Text Directly">Paste Text</button><br>
                <button onclick="getArticle(prompt('Enter Wikipedia Title'));" title="Load Text From The Summary Of A Wikipedia Article">Wikipedia Summary</button><br><br>
                <h2>Save/Load ChatterBot Data</h2>
                <input type="file" id="loadData" multiple="true" title="Import Files, All Files Are Read As Text"><br>
                <button onclick="download()">Save</button>
            </div>
        </div>
        <script>
        try{
            document.getElementById("input").addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    Run()
                    document.getElementById("input").value=""
                }
            });
            document.getElementById("train").addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    gettingArticle=true;
                    process(document.getElementById('train').value);
                    setTimeout(function c(){document.getElementById('train').value='';},100)
                }
            });


            //Modal Handling
            window.onclick = function(event) {
                if (event.target.className == "modal") {
                    document.getElementById("about").style.display = "none";
                    document.getElementById("settings").style.display = "none";
                    document.getElementById("terms").style.display = "none";
                    document.getElementById("add").style.display = "none";
                }
            }

            document.getElementById('inputfile')
            .addEventListener('change', function () {
                readmultifiles(this.files)
            })
            function readmultifiles(files) {
                var reader = new FileReader();
                function readFile(index) {
                    if( index >= files.length ){
                        return;
                    }
                    var file = files[index];
                    reader.onload = function(e) {
                        gettingArticle=true
                        process(e.target.result)
                        readFile(index+1)
                    }
                    reader.readAsText(file);
                }
                readFile(0);
            }


            document.getElementById('loadData')
            .addEventListener('change', function () {
                readmultifiles(this.files)
            })
            function readmultifiles(files) {
                var reader = new FileReader();
                function readFile(index) {
                    if( index >= files.length ){
                        return;
                    }
                    var file = files[index];
                    reader.onload = function(e) {
                        var data=e.target.result.split("<|&>")
                        tokens=JSON.parse(data[0])
                        words=JSON.parse(data[1])
                        associations=JSON.parse(data[2])
                        associationsValue=JSON.parse(data[3])
                        endWord=JSON.parse(data[4])
                        usedArticles=JSON.parse(data[5])
                        document.getElementById("isRight").checked=(data[6]=="true")
                        document.getElementById("useWiki").checked=(data[7]=="true")
                        document.getElementById("showWiki").checked=(data[8]=="true")
                        document.getElementById("usePrompt").checked=(data[9]=="true")
                        document.getElementById("showMap").checked=(data[10]=="true")
                        document.getElementById("min").value=parseInt(data[11])
                        document.getElementById("max").value=parseInt(data[12])

                        readFile(index+1)
                    }
                    reader.readAsText(file);
                }
                readFile(0);
            }

            //saving
            function download() {
                var filename="ChatterBot_Save"
                var text=[JSON.stringify(tokens),JSON.stringify(words),JSON.stringify(associations),
                    JSON.stringify(associationsValue),JSON.stringify(endWord),JSON.stringify(usedArticles),
                    document.getElementById("isRight").checked,
                    document.getElementById("useWiki").checked,
                    document.getElementById("showWiki").checked,
                    document.getElementById("usePrompt").checked,
                    document.getElementById("showMap").checked,
                    document.getElementById("min").value,
                    document.getElementById("max").value
                ].join("<|&>")
                if(filename!=""&&filename!=null){
                    var element = document.createElement('a');
                    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
                    element.setAttribute('download', filename);

                    element.style.display = 'none';
                    document.body.appendChild(element);

                    element.click();

                    document.body.removeChild(element);
                }
            }

            function rand(min, max) {
                return Math.floor(Math.random() * (max - min + 1) ) + min;
            }
            var associationsValue=[]
            var associations=[]
            var words=[]

            var usedArticles=["the","who","is","a","what","your","you","they","are","chatterbot","my","to","that","with","it","in"]
            var gettingArticle=true
            var articleQ=[]

            var tokens=[]

            var endWord=[]

            function getArticle(title){
                if(document.getElementById("useWiki").checked){
                    if(title!=""&&title+""!="null"&&!usedArticles.includes(title)){
                        fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`)
                        .then(r => r.json())
                        .then(data => {
                            usedArticles.push(title)
                            gettingArticle=true
                            if(document.getElementById("showWiki").checked){
                                document.getElementById("text").innerHTML+="<div style='color:grey;font-size:80%'>Loaded Wikipedia Summary: "+title+"</div>"
                            }
                            process(data.extract)
                        })
                        .catch(err => alert(err))
                    }
                }
            }

            function inputSentence(sentence){
                var words1=sentence.split(" ")
                for(var i=0;i<words1.length;i++){
                    if(words1[i]&&words1[i].length>0){
                        if(!words.includes(words1[i])){
                            words.push(words1[i])
                            associations.push([])
                            associationsValue.push([])
                            if(!gettingArticle){
                                articleQ.push(words1[i])
                            }
                        }
                        if(i==words1.length-1){
                            endWord.push(words1[i])
                        }
                    }else{
                        words1.splice(i,1)
                        i-=1
                    }
                }
                for(var i=0;i<words1.length;i++){
                    for(var j=0;j<words1.length;j++){
                        if(i!=j){
                            if(associations[words.indexOf(words1[i])].includes(words1[j])){
                                associationsValue[words.indexOf(words1[i])][associations[words.indexOf(words1[i])].indexOf(words1[j])]+=1
                            }else{
                                associations[words.indexOf(words1[i])].push(words1[j])
                                associationsValue[words.indexOf(words1[i])].push(1)
                            }
                        }
                    }
                }
            }
            function getAssociated(word){
                var list=[]
                if(!words.includes(word)){
                    return [words[rand(0,words.length-1)]]
                }
                var total=0
                for(var i=0;i<associations[words.indexOf(word)].length;i++){
                    total+=associationsValue[words.indexOf(word)][i]
                }
                for(var i=0;i<associations[words.indexOf(word)].length;i++){
                    if(associationsValue[words.indexOf(word)][i]/total<Math.random()){
                        //for(var j=0;j<associationsValue[words.indexOf(word)][i];j++){
                            list.push(associations[words.indexOf(word)][i])
                        //}
                    }
                }
                if(list.length==0){
                    return [words[rand(0,words.length-1)]]
                }
                var list2=[]
                var j=rand(parseInt(document.getElementById("min").value),parseInt(document.getElementById("max").value))
                for(var i=0;i<j;i++){
                    list2.push(list[rand(0,list.length-1)])
                }
                return list2
            }
            function process(text){
            try{
                if(text){
                    text=text.replaceAll("_"," ")
                    text=text.replaceAll("-"," ")
                    text=[...text.toLowerCase()].filter(t => {return "abcdefghijklmnopqrstuvwxyz 1234567890'.?!".includes(t)}).join("")
                    var newText=text.replaceAll(".","&$*")
                    newText=newText.replaceAll("!","&$*")
                    newText=newText.replaceAll("?","&$*")
                    var list=newText.split("&$*")
                    for(var i=0;i<list.length;i++){
                        inputSentence(list[i])
                    }
                    var newTokens=text.toLowerCase().match(/\b[a-z'0-9]+\b|[.!?]/g) || [];
                    tokens.push(...newTokens)
                    gettingArticle=false
                }
            }catch(e){
                alert(e+"\n"+text)
            }
            }

            //GPT WRITTEN:
                // --- Tokenize plain text ---
                function tokenize(text) {
                    // Match words or punctuation separately
                    // Sentence ends: . ! ?
                    return text.toLowerCase().match(/\b[a-z'0-9]+\b|[.!?]/g) || [];
                }
                // --- Build bigram graph ---
                function buildGraph(tokens) {
                    const graph = {};
                    for (let i = 0; i < tokens.length - 1; i++) {
                        const a = tokens[i], b = tokens[i + 1];
                        if (a === '.' || a === '!' || a === '?') continue;
                        if (!graph[a]) graph[a] = new Set();
                        graph[a].add(b);
                    }
                    return graph;
                }
                // --- BFS to find shortest word path ---
                function bfs(graph, start, goal) {
                    if (!graph[start] || !graph[goal]) return null;
                    const queue = [[start]];
                    const visited = new Set([start]);

                    while (queue.length > 0) {
                        const path = queue.shift();
                        const node = path[path.length - 1];
                        if (node === goal) return path;

                        const neighbors = graph[node] || [];
                        for (let next of neighbors) {
                            if (!visited.has(next)) {
                                visited.add(next);
                                queue.push([...path, next]);
                            }
                        }
                    }
                    return null;
                }
                function capitalizeSentences(text) {
                    if (!text) return '';

                    // Use a regular expression to split the text into sentences,
                    // preserving the delimiters (periods, question marks, exclamation marks).
                    // The regex /(?<=[.?!])\s*/g splits after a sentence-ending punctuation
                    // followed by optional whitespace.
                    const sentences = text.split(/(?<=[.?!])\s*/g);

                    const capitalizedSentences = sentences.map(sentence => {
                        // Trim whitespace from the beginning and end of the sentence
                        const trimmedSentence = sentence.trim();

                        if (trimmedSentence.length === 0) {
                        return ''; // Handle empty sentences resulting from splitting
                        }

                        // Capitalize the first letter and concatenate with the rest of the sentence
                        return trimmedSentence.charAt(0).toUpperCase() + trimmedSentence.slice(1);
                    });

                    // Join the capitalized sentences back together with a space
                    return capitalizedSentences.join(' ');
                }
            //END

            function Run(){
            try{
                var input=document.getElementById("input").value
                if(input.length>0){
                    if(document.getElementById("usePrompt").checked){
                        process(input)
                    }
                    input=[...input.toLowerCase()].filter(t => {return "abcdefghijklmnopqrstuvwxyz 1234567890'".includes(t)}).join("")
                    input=input.split(" ")
                    var keyWords=[]
                    for(var i=0;i<input.length;i++){
                        keyWords.push(...getAssociated(input[i]))
                    }
                    for(var i=0;i<5;i++){
                        keyWords.push(endWord[rand(0,endWord.length-1)])
                    }

                    var graph=buildGraph(tokens)

                    var sentence=""
                    for(var i=0;i<keyWords.length-1;i++){
                        var b=bfs(graph,keyWords[i],keyWords[i+1])
                        if(b){
                            sentence+=b.slice(0,b.length-1).join(" ")+" "
                        }else{
                            sentence+=keyWords[i]+". "
                            if(i>keyWords.length-6){
                                break
                            }
                        }
                    }
                    if(document.getElementById("isRight").checked){
                        document.getElementById("text").innerHTML+="<br><b style='float:right'>"+document.getElementById("input").value+"</b><br><br>"
                    }else{
                        document.getElementById("text").innerHTML+="<br><b>"+document.getElementById("input").value+"</b><br><br>"
                    }
                    if(document.getElementById("showMap").checked){
                        document.getElementById("text").innerHTML+=JSON.stringify(keyWords)+"<br>"
                    }
                    document.getElementById("text").innerHTML+=capitalizeSentences(sentence)
                }
            }catch(e){
                alert(e)
            }
            }

            function IntRun(){
                if(articleQ.length>0){
                    getArticle(articleQ[0])
                    articleQ.shift()
                }
                document.getElementById('wordCount').innerHTML=words.length+' Known Words'
            }
            setInterval(IntRun,100)

            //process("I am ChatterBot 7.")

        }catch(e){
            alert(e)
        }
        </script>
    </body>
</html>

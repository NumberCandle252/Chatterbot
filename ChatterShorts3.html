<!DOCTYPE html>
<html>
    <head>
        <title>ChatterShorts 3</title>
        <meta charset="UTF-8">
        <style>
            /* This controls the responsive sizing */
            #canvas-container {
                position: relative;
                height: 80vh; /* scales down nicely on mobile */
                aspect-ratio: 3 / 5;     /* keeps 300x500 proportions */
            }

            /* All canvases fill the container */
            #canvas-container canvas {
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100%;
            }
            #game-wrapper {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }
            #Comments{
                color:white;
            }

            .bottom-controls button {
                /*padding: 12px 18px;*/
                font-size: 1.3em;
                width:10vw;
                height:5vh;
                background-color: #555;
                color: white;
            }
            .bottom-controls button:disabled {
                background-color: #333;
            }


            /* Stack order */
            #THREEcanvas   { z-index: 0; }
            #IMGcanvas { z-index: 1; }
            #Canvas   { z-index: 2; }

        </style>
    </head>
    <body style="background-color: #223;">
        <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>

        <div id="game-wrapper">
            <div id="canvas-container">
                <canvas id="THREEcanvas" style="background-color: black;" width="300" height="500"></canvas>
                <canvas id="IMGcanvas" width="300" height="500"></canvas>
                <canvas id="Canvas" width="300" height="500"></canvas>
            </div>

            <div class="controls bottom-controls">
                <button id="sub" onclick="Subscribe()">Subscribe</button>
                <button id="up" onclick="favorLike()">üëç</button>
                <button id="down" onclick="favorDislike()">üëé</button>
                <br>
                <button onclick="Search()">Search</button>
                <button onclick="if(!loading){randomKeys();Generate()}">Scroll</button>
                <button onclick="viewComment()">Comments </button>
            </div>
        </div>
        <div id="Comments" style="display:none">
            <div class="controls bottom-controls">
                <button onclick="viewComment()">Back</button>
            </div>
            <div id="chatComment"></div>
        </div>

        <script>
        try{
            alert("Flashing Light Warning\n By Using This Site You Agree That Any Content Generated By ChatterBot Is Not The Fault Of The Creator")

            function rand(min, max) {
                return Math.floor(Math.random() * (max - min + 1) ) + min;
            }
            function dist(x1,y1,x2,y2){
                return parseFloat(Math.sqrt(((x1-x2)**2)+((y1-y2)**2)))
            }

            function line(x1,y1,x2,y2,width,color){
                ctx.strokeStyle = color;
                ctx.lineWidth = width;
                ctx.beginPath();
                ctx.moveTo(x1,y1);
                ctx.lineTo(x2,y2);
                ctx.stroke();
            }
            function circle(x,y,r,c,stroke=false,arc=2){
                ctx.fillStyle =c;
                ctx.strokeStyle=c;
                ctx.beginPath();
                ctx.arc(x,y, r, 0, arc * Math.PI);
                if(stroke){
                    ctx.stroke()
                }else{
                    ctx.fill();
                }
            }
            function square(x,y,r,c){
                ctx.fillStyle=c
                ctx.fillRect(x-r,y-r,r*2,r*2)
            }
            function wrapText(text, x, y, maxWidth, lineHeight) {
                const words = text.split(' ');
                let line = '';
                for (let n = 0; n < words.length; n++) {
                    const testLine = line + words[n] + ' ';
                    const metrics = ctx.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > maxWidth && n > 0) {
                    ctx.fillText(line, x, y);
                    line = words[n] + ' ';
                    y += lineHeight;
                    } else {
                        if(words[n]=="\n"){
                            ctx.fillText(line, x, y);
                            line = ' ';
                            y += lineHeight;
                        }else{
                            line = testLine;
                        }
                    }
                }
                ctx.fillText(line, x, y);
            }

            function disposeObject(obj) {
                // Remove from parent
                if (obj.parent) obj.parent.remove(obj);

                // Dispose geometry
                if (obj.geometry) {
                    obj.geometry.dispose();
                }

                // Dispose materials
                if (obj.material) {
                    // Some objects use an array of materials
                    if (Array.isArray(obj.material)) {
                        obj.material.forEach((m) => m.dispose());
                    } else {
                        obj.material.dispose();
                    }
                }

                // Optionally dispose textures if you're managing them manually
                // obj.material.map?.dispose();

                // Also dispose children recursively if it's a group
                obj.traverse((child) => {
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) {
                        if (Array.isArray(child.material)) {
                            child.material.forEach((m) => m.dispose());
                        } else {
                            child.material.dispose();
                        }
                    }
                });
            }

            function viewComment(){
                if(document.getElementById("game-wrapper").style.display=="none"){
                    document.getElementById("game-wrapper").style.display="flex"
                    document.getElementById("Comments").style.display="none"
                }else{
                    document.getElementById("game-wrapper").style.display="none"
                    document.getElementById("Comments").style.display="block"
                }
            }

            function favorLike(){
                if(!loading){
                    favor.push(...keys)
                    document.getElementById("up").disabled=true
                }
            }
            function favorDislike(){
                if(!loading){
                    for(var i=0;i<keys.length;i++){
                        if(favor.includes(keys[i])){
                            favor.splice(favor.indexOf(keys[i]),1)
                        }
                    }
                    document.getElementById("down").disabled=true
                }
            }
            var favor=[]

            function Search(){
                if(!loading){
                    var name=prompt("Search For Video Title")
                    if(name&&name.length>0){
                        keys=name.split(" ")
                        for(var i=0;i<5;i++){
                            favor.push(...keys)
                        }
                        Generate()
                    }
                }
            }

            //THREE JS Setup
            let scene = new THREE.Scene();
            let camera = new THREE.PerspectiveCamera(75, THREEcanvas.clientWidth / THREEcanvas.clientHeight, 0.1, 100);
            let renderer = new THREE.WebGLRenderer({canvas:document.getElementById("THREEcanvas")});
            renderer.setSize(THREEcanvas.clientWidth,THREEcanvas.clientHeight)
            renderer.setClearColor('grey');
            camera.position.set(0,0,0)

            //Main Canvas Setup
            var ctx=document.getElementById("Canvas").getContext("2d")

            //Image Canvas Setup
            var imgCtx=document.getElementById("IMGcanvas").getContext("2d")

            async function getWikipediaImage(title) {
                // Step 1: get list of images used in the article
                const listUrl =
                    "https://en.wikipedia.org/w/api.php" +
                    "?action=query" +
                    "&format=json" +
                    "&prop=images" +
                    "&origin=*" +
                    "&titles=" + encodeURIComponent(title);

                const listResponse = await fetch(listUrl);
                const listData = await listResponse.json();

                const pages = listData.query.pages;
                const page = Object.values(pages)[0];
                if (!page.images) return null;

                // Step 2: clean the list
                const imageTitles = page.images
                    .map(img => img.title)
                    .filter(name =>
                    /\.(jpg|jpeg|png)$/i.test(name) &&       // real images
                    !/icon|logo|symbol|flag|map/i.test(name) // avoid UI clutter
                    );

                if (imageTitles.length === 0) return null;

                // Pick a random image
                const randomTitle =
                    imageTitles[Math.floor(Math.random() * imageTitles.length)];

                // Step 3: get image URL
                const infoUrl =
                    "https://en.wikipedia.org/w/api.php" +
                    "?action=query" +
                    "&format=json" +
                    "&prop=imageinfo" +
                    "&iiprop=url" +
                    "&origin=*" +
                    "&titles=" + encodeURIComponent(randomTitle);

                const infoResponse = await fetch(infoUrl);
                const infoData = await infoResponse.json();

                const imagePage = Object.values(infoData.query.pages)[0];
                return imagePage.imageinfo?.[0]?.url || null;
            }

            function loadImage(url) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = "anonymous";
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = url;
                });
            }
            function imageToPixelArray(img, width, height) {
                const canvas = document.createElement("canvas");
                canvas.width = width;
                canvas.height = height;

                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, width, height);

                const data = ctx.getImageData(0, 0, width, height).data;

                const pixels = [];
                for (let y = 0; y < height; y++) {
                    const row = [];
                    for (let x = 0; x < width; x++) {
                        const i = (y * width + x) * 4;
                        row.push([data[i],data[i+1],data[i+2]]);
                    }
                    pixels.push(row);
                }
                return pixels;
            }
            async function runImage(titles,a) {
                try{
                loading=true
                imgCtx.clearRect(0,0,IMGcanvas.width,IMGcanvas.height)
                var pixels=[]
                for(var i=0;i<titles.length;i++){
                    var imageUrl = await getWikipediaImage(titles[i]);
                    if (imageUrl) {
                        var img = await loadImage(imageUrl);
                        pixels.push(imageToPixelArray(img, Canvas.width, Canvas.height));
                    }
                }
                if(pixels.length!=0){
                    imgCtx.globalAlpha=a
                    for(var x=0;x<Canvas.width;x++){
                        for(var y=0;y<Canvas.height;y++){
                            var rgb=[0,0,0]
                            for(var i=0;i<pixels.length;i++){
                                rgb[0]+=pixels[i][y][x][0]
                                rgb[1]+=pixels[i][y][x][1]
                                rgb[2]+=pixels[i][y][x][2]
                            }
                            rgb[0]/=pixels.length
                            rgb[1]/=pixels.length
                            rgb[2]/=pixels.length
                            imgCtx.fillStyle="rgb("+rgb[0]+","+rgb[1]+","+rgb[2]+")"
                            imgCtx.fillRect(x,y,1,1)
                        }
                    }
                    imgCtx.globalAlpha=1
                }

                await waitForCondition();

                var j=rand(10,500)
                document.getElementById("chatComment").innerHTML=""
                var nameWords=["chat","bot","ai","chatter","pixel","lost","chatterbot","user","name","night","shorts","comment","system","auto","key"]
                for(var i=0;i<j;i++){
                    var name=nameWords[rand(0,nameWords.length-1)]+["-","_",""][rand(0,2)]
                    name+=nameWords[rand(0,nameWords.length-1)]+["-","_",""][rand(0,2)]
                    name+=nameWords[rand(0,nameWords.length-1)]+""+rand(0,1000)
                    document.getElementById("chatComment").innerHTML+=name+": <p style='text-indent:3%'>"+Chatter(normKeys(),rand(0,2)!=0,rand(20,150))+"</p>"
                }

                loading=false
                }catch(e){
                    alert(e)
                }
            }
            function waitForCondition(interval = 50) {
                return new Promise(resolve => {
                    const id = setInterval(() => {
                        if (articleQ.length==0) {
                            clearInterval(id);
                            resolve();
                        }
                    }, interval);
                });
            }


            var associationsValue=[]
            var associations=[]
            var words=[]

            var usedArticles=["the","who","is","a","what","your","you","they","are","chatterbot","my","to","that","with","it","in"]
            var articleQ=[]
            var tokens=[]

            function runArticle(){
                if(articleQ.length>0){
                    getArticle(articleQ.shift())
                }
            }
            let artInter=setInterval(runArticle,10)
            function getArticle(title){
                if(title!=""&&title+""!="null"&&!usedArticles.includes(title)){
                    fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`)
                    .then(r => r.json())
                    .then(data => {
                        usedArticles.push(title)
                        process(data.extract)
                    })
                    .catch(err => alert(err))
                }
            }

            function inputSentence(sentence){
                var words1=sentence.split(" ")
                for(var i=0;i<words1.length;i++){
                    if(words1[i]&&words1[i].length>0){
                        if(!words.includes(words1[i])){
                            words.push(words1[i])
                            associations.push([])
                            associationsValue.push([])
                        }
                    }else{
                        words1.splice(i,1)
                        i-=1
                    }
                }
                for(var i=0;i<words1.length;i++){
                    for(var j=0;j<words1.length;j++){
                        if(i!=j){
                            if(associations[words.indexOf(words1[i])].includes(words1[j])){
                                associationsValue[words.indexOf(words1[i])][associations[words.indexOf(words1[i])].indexOf(words1[j])]+=1
                            }else{
                                associations[words.indexOf(words1[i])].push(words1[j])
                                associationsValue[words.indexOf(words1[i])].push(1)
                            }
                        }
                    }
                }
            }
            function getAssociated(word){
                var list=[]
                if(!words.includes(word)){
                    return [words[rand(0,words.length-1)]]
                }
                var total=0
                for(var i=0;i<associations[words.indexOf(word)].length;i++){
                    total+=associationsValue[words.indexOf(word)][i]
                }
                for(var i=0;i<associations[words.indexOf(word)].length;i++){
                    if(associationsValue[words.indexOf(word)][i]/total<Math.random()){
                        //for(var j=0;j<associationsValue[words.indexOf(word)][i];j++){
                            list.push(associations[words.indexOf(word)][i])
                        //}
                    }
                }
                if(list.length==0){
                    return [words[rand(0,words.length-1)]]
                }
                var list2=[]
                var j=rand(1,3)
                for(var i=0;i<j;i++){
                    list2.push(list[rand(0,list.length-1)])
                }
                return list2
            }
            function process(text){
            try{
                if(text){
                    text=text.replaceAll("_"," ")
                    text=text.replaceAll("-"," ")
                    text=[...text.toLowerCase()].filter(t => {return "abcdefghijklmnopqrstuvwxyz 1234567890'.?!".includes(t)}).join("")
                    var newText=text.replaceAll(".","&$*")
                    newText=newText.replaceAll("!","&$*")
                    newText=newText.replaceAll("?","&$*")
                    var list=newText.split("&$*")
                    for(var i=0;i<list.length;i++){
                        inputSentence(list[i])
                    }
                    var newTokens=text.toLowerCase().match(/\b[a-z'0-9]+\b|[.!?]/g) || [];
                    tokens.push(...newTokens)
                }
            }catch(e){
                alert(e+"\n"+text)
            }
            }

            //GPT WRITTEN:
                // --- Tokenize plain text ---
                function tokenize(text) {
                    // Match words or punctuation separately
                    // Sentence ends: . ! ?
                    return text.toLowerCase().match(/\b[a-z'0-9]+\b|[.!?]/g) || [];
                }
                // --- Build bigram graph ---
                function buildGraph(tokens) {
                    const graph = {};
                    for (let i = 0; i < tokens.length - 1; i++) {
                        const a = tokens[i], b = tokens[i + 1];
                        if (a === '.' || a === '!' || a === '?') continue;
                        if (!graph[a]) graph[a] = new Set();
                        graph[a].add(b);
                    }
                    return graph;
                }
                // --- BFS to find shortest word path ---
                function bfs(graph, start, goal) {
                    if (!graph[start] || !graph[goal]) return null;
                    const queue = [[start]];
                    const visited = new Set([start]);

                    while (queue.length > 0) {
                        const path = queue.shift();
                        const node = path[path.length - 1];
                        if (node === goal) return path;

                        const neighbors = graph[node] || [];
                        for (let next of neighbors) {
                            if (!visited.has(next)) {
                                visited.add(next);
                                queue.push([...path, next]);
                            }
                        }
                    }
                    return null;
                }
            //end

            function Chatter(input,useE=true,size=20){
                //process(input)
                input=[...input.toLowerCase()].filter(t => {return "abcdefghijklmnopqrstuvwxyz 1234567890'".includes(t)}).join("")
                input=input.split(" ")
                var keyWords=[]
                for(var i=0;i<2;i++){
                    keyWords.push(...getAssociated(input[i]))
                }

                var graph=buildGraph(tokens)

                var sentence=""
                for(var i=0;i<keyWords.length-1;i++){
                    var b=bfs(graph,keyWords[i],keyWords[i+1])
                    if(b){
                        sentence+=b.slice(0,b.length-1).join(" ")+" "
                    }else{
                        sentence+=keyWords[i]+". "
                    }
                    //sentence+="ü§£üò≠üî•‚ú®üíïüíÄüò±"[rand(0,6)]+" "
                }
                return sentence.slice(0,Math.min(size,sentence.length-1))
            }

            class RandomLook{
                constructor(){
                    this.tiles=[]
                    for(var i=0;i<100;i++){
                        this.tiles.push(new THREE.Mesh(
                            new THREE.BoxGeometry(rand(1,10), rand(1,10), rand(1,10)),
                            new THREE.MeshBasicMaterial({ color: "rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")" })
                        ))
                        this.tiles[this.tiles.length-1].position.set(rand(-20,20),rand(-20,20),rand(-20,20))
                        scene.add(this.tiles[this.tiles.length-1])
                    }
                    this.v=rand(-10,10)
                }
                run(){
                    camera.rotation.y+=0.001*this.v
                    return true
                }
                cleanUp(){
                    for(var i=0;i<this.tiles.length;i++){
                        disposeObject(this.tiles[i])
                    }
                }
            }
            class Parkour{
                constructor(){
                    // Parkour blocks
                    this.blocks = [];
                    this.lastBlockZ = 0;

                    // Initial blocks
                    for (let i = 0; i < 15; i++) {
                        this.createBlock(-i * 4);
                        this.lastBlockZ = -i * 4;
                    }

                    // Player movement
                    this.speed = 0.05;
                    this.jumpTimer = 0;
                }
                createBlock(z) {
                    const geo = new THREE.BoxGeometry(2, 0.5, 2);
                    const block = new THREE.Mesh(geo, new THREE.MeshBasicMaterial(
                        {color: "rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"}));

                    block.position.set(
                        (Math.random() - 0.5) * 3,
                        Math.random() * 1.5,
                        z
                    );

                    scene.add(block);
                    this.blocks.push(block);
                }
                run(){
                    // Move forward
                    camera.position.z -= this.speed;
                    this.jumpTimer += 0.05;

                    // Jump arc
                    camera.position.y = 2 + Math.sin(this.jumpTimer) * 0.6;

                    // Follow X of next block slightly
                    const nextBlock = this.blocks[1];
                    if (nextBlock) {
                        camera.position.x += (nextBlock.position.x - camera.position.x) * 0.02;
                    }

                    // Generate new blocks
                    if (camera.position.z < this.lastBlockZ + 40) {
                        this.lastBlockZ -= 4;
                        this.createBlock(this.lastBlockZ);
                    }

                    // Remove old blocks
                    if (this.blocks.length && this.blocks[0].position.z > camera.position.z + 5) {
                        disposeObject(this.blocks[0]);
                        this.blocks.shift();
                    }
                    return true
                }
                cleanUp(){
                    for(var i=0;i<this.blocks.length;i++){
                        disposeObject(this.blocks[i])
                    }
                    this.blocks=[]
                }
            }

            class BounceItem{
                constructor(){
                    this.x=rand(10,Canvas.width-10)
                    this.y=rand(10,Canvas.height-10)
                    this.vX=rand(-10,10)/10
                    this.vY=rand(-10,10)/10

                    this.type=rand(0,1)
                    this.size=rand(5,50)
                    this.color="rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"
                    this.a=rand(20,60)/100
                }
                run(){
                    ctx.globalAlpha=this.a
                    if(this.type==0){
                        circle(this.x,this.y,this.size,this.color)
                    }else{
                        square(this.x,this.y,this.size,this.color)
                    }
                    ctx.globalAlpha=1
                    this.x+=this.vX
                    this.y+=this.vY

                    if(this.y<1){
                        this.y=1
                        this.vY=-this.vY
                    }
                    if(this.y>Canvas.height-2){
                        this.y=Canvas.height-2
                        this.vY=-this.vY
                    }
                    if(this.x<1){
                        this.x=1
                        this.vX=-this.vX
                    }
                    if(this.x>Canvas.width-2){
                        this.x=Canvas.width-2
                        this.vX=-this.vX
                    }
                    return true
                }
            }
            class MoveItem{
                constructor(){
                    this.x=rand(10,Canvas.width-10)
                    this.y=rand(10,Canvas.height-10)
                    this.vX=rand(-10,10)/8
                    this.vY=rand(-10,10)/8

                    this.type=rand(0,1)
                    this.size=rand(5,50)
                    this.color="rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"
                    this.a=rand(30,60)/100
                }
                run(){
                    ctx.globalAlpha=this.a
                    if(this.type==0){
                        circle(this.x,this.y,this.size,this.color)
                    }else{
                        square(this.x,this.y,this.size,this.color)
                    }
                    ctx.globalAlpha=1
                    this.x+=this.vX
                    this.y+=this.vY

                    if(this.y<-50){
                        this.y=Canvas.height+50
                    }
                    if(this.y>Canvas.height+50){
                        this.y=-50
                    }
                    if(this.x<-50){
                        this.x=Canvas.width+50
                    }
                    if(this.x>Canvas.width+50){
                        this.x=-50
                    }
                    return true
                }
            }
            class ColorOverlay{
                constructor(){
                    this.timeWait=rand(10,500)
                    this.time=this.timeWait
                    this.color="rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"
                    this.a=rand(1,30)/100
                }
                run(){
                    ctx.globalAlpha=this.a
                    ctx.fillStyle=this.color
                    ctx.fillRect(0,0,Canvas.width,Canvas.height)
                    ctx.globalAlpha=1

                    this.time-=1
                    if(this.time<0){
                        this.time=this.timeWait
                        this.color="rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"
                    }
                    return true
                }
            }
            class Lines{
                constructor(){
                    this.timeWait=rand(50,500)
                    this.time=this.timeWait
                    this.color="rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"
                    this.a=rand(50,100)/100
                    this.pos=[rand(0,Canvas.height),rand(0,Canvas.height)]
                    this.size=rand(1,20)
                }
                run(){
                    ctx.globalAlpha=this.a
                    ctx.fillStyle=this.color
                    line(0,this.pos[0],Canvas.width,this.pos[1],this.size,this.color)
                    ctx.globalAlpha=1

                    this.time-=1
                    if(this.time<0){
                        this.time=this.timeWait
                        this.color="rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"
                        this.size=rand(1,20)
                        this.pos=[rand(0,Canvas.height),rand(0,Canvas.height)]
                    }
                    return true
                }
            }
            class Text{
                constructor(){
                    this.text=""
                    this.color="rgb("+rand(0,255)+","+rand(0,255)+","+rand(0,255)+")"
                    this.font=rand(15,30)+"px "+["Arial","Verdana","Tahoma","Trebuchet MS","Times New Roman","Georgia","Garamond","Courier New","Brush Script MT"][rand(0,8)]
                    this.a=rand(50,80)/100
                    this.x=rand(100,200)
                    this.y=rand(100,400)
                    this.w=rand(100,200)
                    this.h=rand(20,30)
                }
                run(){
                    if(this.text==""){
                        this.text=Chatter(normKeys())
                    }
                    ctx.globalAlpha=this.a
                    ctx.fillStyle=this.color
                    ctx.font=this.font
                    ctx.textAlign="center"
                    wrapText(this.text,this.x,this.y,this.w,this.h)
                    ctx.globalAlpha=1

                    return true
                }
            }

            var creator=[0,0,[]]
            var subIndex=-1
            var subs=[]

            function Subscribe(){
                if(!loading){
                    if(subIndex==-1){
                        subs.push(JSON.parse(JSON.stringify(creator)))
                        subIndex=subs.length-1
                    }else{
                        subs.splice(subIndex,1)
                        subIndex=-1
                    }
                }
            }

            function Generate(){
                if(!loading){
                    localStorage.setItem("shorts3Data",JSON.stringify([subs,favor]))
                    subIndex=-1
                    if(subs.length>0&&rand(0,1)==0){
                        subIndex=rand(0,subs.length-1)
                        creator=JSON.parse(JSON.stringify(subs[subIndex]))
                    }else{
                        creator=[rand(4,10)/10,rand(0,1),[]]
                        if(rand(0,1)==0){
                            var o=rand(0,3)
                            for(var i=0;i<10;i++){
                                creator[2].push(o)
                            }
                        }
                        if(rand(0,2)==0){
                            var o=rand(0,3)
                            for(var i=0;i<5;i++){
                                creator[2].push(o)
                            }
                        }
                        if(rand(0,2)==0){
                            var o=rand(0,3)
                            for(var i=0;i<5;i++){
                                creator[2].push(o)
                            }
                        }
                        var j=rand(0,15)
                        for(var i=0;i<j;i++){
                            creator[2].push(rand(0,3))
                        }
                    }


                    runImage(keys,creator[0])
                    articleQ=[...keys]

                    document.getElementById("up").disabled=false
                    document.getElementById("down").disabled=false

                    camera.position.set(0,0,0)
                    camera.rotation.set(0,0,0)

                    var g=rand(0,255)
                    renderer.setClearColor("rgb("+g+","+g+","+g+")");

                    main3d.cleanUp()
                    main3d=new [Parkour,RandomLook][creator[1]]()

                    obj=[]
                    for(var i=0;i<creator[2].length;i++){
                        obj.push(new [BounceItem,Text,MoveItem,Lines,ColorOverlay][creator[2][i]]())
                    }

                    window.speechSynthesis.cancel()
                    pitch1=rand(20,180)/100
                    untilNewNote=rand(100,500)
                    while(notes.length>0){
                        notes[0].stop()
                        notes.shift()
                    }
                }
            }
            function randomKeys(){
                var list=["Earth","Moon","Sun","Solar_System","Milky_Way","Universe","Black_hole","Supernova","Neutron_star","Galaxy","Light_year",
"Speed_of_light","Gravity","Quantum_mechanics","Relativity","DNA","Evolution","Natural_selection","Photosynthesis","Cell_(biology)","Mitochondrion","Atom","Molecule","Chemical_element","Periodic_table",
"Water","Oxygen","Carbon","Iron","Gold","Electricity","Magnetism","Computer","Internet","World_Wide_Web","Artificial_intelligence","Machine_learning","Algorithm","Programming_language",
"Python_(programming_language)","JavaScript","Operating_system","Linux","Microsoft_Windows","Apple_Inc.","Smartphone","Video_game","Virtual_reality","Augmented_reality","Robotics","Automation",
"Steam_engine","Industrial_Revolution","Printing_press","Compass","Gunpowder","Wheel","Mathematics","Algebra","Geometry","Calculus","Prime_number","Infinity","Zero","Fibonacci_number","Pi","Golden_ratio","Statistics",
"Probability","Chess","Go_(game)","Sudoku","Rubik%27s_Cube","Olympic_Games","Football","Basketball","Baseball","Tennis","Swimming","Running","Mount_Everest","Himalayas","Sahara","Amazon_rainforest",
"Pacific_Ocean","Atlantic_Ocean","Antarctica","Arctic","Volcano","Earthquake","Tsunami","Hurricane","Tornado","Climate_change","Global_warming","Greenhouse_effect","Renewable_energy","Solar_power",
"Wind_power","Hydroelectricity","Nuclear_power","Fossil_fuel","Oil","Coal","Natural_gas","Recycling","Pollution","Biodiversity","Endangered_species","Dinosaur","Tyrannosaurus","Triceratops","Velociraptor",
"Mammal","Bird","Reptile","Amphibian","Fish","Insect","Honeybee","Ant","Butterfly","Spider","Octopus","Dolphin","Whale","Elephant","Lion","Human","Brain","Heart","Lung","Blood","Immune_system",
"Virus","Bacteria","Vaccine","Antibiotic","Pandemic","Black_Death","Influenza","COVID-19","History","Ancient_Egypt","Roman_Empire","Greek_mythology","Middle_Ages","Renaissance","Age_of_Enlightenment",
"French_Revolution","American_Revolution","World_War_I","World_War_II","Cold_War","Space_Race","Apollo_11","Moon_landing","International_Space_Station","NASA","SpaceX","Rocket","Satellite","GPS",
"Astronaut","Time","Calendar","Leap_year","Time_zone","Philosophy","Ethics","Logic","Psychology","Cognition","Memory","Emotion","Consciousness","Language","Linguistics","Alphabet","Writing","Printing",
"Book","Library","Education","School","University","Science","Technology","Engineering","Medicine","Economics","Supply_and_demand","Inflation","Cryptocurrency","Bitcoin","Blockchain"]
                if(rand(0,10)!=0){//small chance of exploration
                    for(var i=0;i<5;i++){
                        list.push(...favor)
                    }
                }
                keys=[]
                for(var i=0;i<3;i++){
                    keys.push(list[rand(0,list.length-1)])
                }
            }
            function normKeys(){
                return keys.join(" ").replaceAll("_"," ")
            }

            var pitch1=1
            function readText(text){
                var msg = new SpeechSynthesisUtterance();
                msg.text = text
                msg.pitch=pitch1+rand(-10,10)/100//rand(1,180)/100
                msg.rate=2+rand(-10,10)/50//rand(1,40)/10
                window.speechSynthesis.speak(msg);
            }
            readText("Started")

            var keys=[]

            var obj=[]
            var main3d=new Parkour()

            var loading=false

            var notes=[]
            var untilNewNote=rand(100,500)
            let audioCtx = new AudioContext();
            let gainNode = new GainNode(audioCtx, {
                gain: 0.03, // Default is 1; 0.5 is half volume, 0 is silent
            });

            var time=0

            function Run(){
            try{
                ctx.clearRect(0,0,Canvas.width,Canvas.height)
                if(loading){
                    ctx.fillStyle="black"
                    ctx.fillRect(0,0,Canvas.width,Canvas.height)
                    ctx.fillStyle="white"
                    ctx.font="18px Arial"
                    ctx.textAlign="center"
                    ctx.textBaseline="middle"
                    ctx.fillText("Loading...",Canvas.width/2,Canvas.height/2)
                    if(notes.length>0){
                        while(notes.length>0){
                            notes[0].stop()
                            notes.shift()
                        }
                    }
                }else{
                    for(var i=0;i<obj.length;i++){
                        if(!obj[i].run()){
                            obj.splice(i,1)
                            i-=1
                        }
                    }
                    renderer.render(scene, camera);
                    main3d.run()

                    if(!window.speechSynthesis.pending && !window.speechSynthesis.speaking){
                        readText(Chatter(normKeys(),false))
                    }
                    if(notes.length<5){
                        let oscillator = audioCtx.createOscillator();
                        oscillator.type = ["sine","square","triangle","sawtooth"][rand(0,3)];
                        oscillator.frequency.setValueAtTime(rand(200,700), audioCtx.currentTime); // value in hertz
                        oscillator.connect(gainNode).connect(audioCtx.destination);
                        oscillator.start();
                        notes.push(oscillator)
                    }
                    if(time%untilNewNote==0){
                        notes[0].stop()
                        notes.shift()
                    }
                }
                ctx.fillStyle="white"
                ctx.font="10px Arial"
                ctx.textAlign="left"
                ctx.textBaseline="bottom"
                ctx.fillText(normKeys(),10,Canvas.height-10)

                if(subIndex!=-1){
                    document.getElementById("sub").style.backgroundColor="tomato"
                    document.getElementById("sub").innerHTML="Subscribed"
                }else{
                    document.getElementById("sub").style.backgroundColor="#555"
                    document.getElementById("sub").innerHTML="Subscribe"
                }

                time+=1
            }catch(e){
                alert(e)
                clearInterval(Inter)
            }
            }
            let Inter=setInterval(Run,10)

            var data=localStorage.getItem("shorts3Data")
            if(data){
                data=JSON.parse(data)
                subs=data[0]
                favor=data[1]
            }

            randomKeys()
            Generate()
        }catch(e){
            alert(e)
        }
        </script>
    </body>
</html>
